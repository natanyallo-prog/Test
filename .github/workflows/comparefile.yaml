name: Compare files with variable and secret

on:
  workflow_dispatch:

jobs:
  job1_compare_variable:
    name: Job 1 - Compare file with repository variable
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Compare class.txt with repo variable
        env:
          REPO_VAR: ${{ vars.NathanK }}
        run: |
          FILE_VALUE=$(tr -d '\n' < class.txt)

          if [ "$FILE_VALUE" != "$REPO_VAR" ]; then
            echo "âŒ class.txt does not match repository variable"
            exit 1
          fi

          echo "âœ… class.txt matches repository variable"

  job2_compare_secret:
    name: Job 2 - Compare file with secret
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Compare class.txt with secret
        env:
          SECRET_VALUE: ${{ secrets.MY_SECRET }}
        run: |
          FILE_VALUE=$(tr -d '\n' < class.txt)

          if [ "$FILE_VALUE" != "$SECRET_VALUE" ]; then
            echo "âŒ class.txt does not match secret"
            exit 1
          fi

          echo "âœ… class.txt matches secret"

  job3_success:
    name: Job 3 - Run only if Job 1 and Job 2 succeed
    runs-on: ubuntu-latest
    needs:
      - job1_compare_variable
      - job2_compare_secret

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Print values and confirm success
        env:
          REPO_VAR: ${{ vars.NathanK }}
        run: |
          FILE_VALUE=$(tr -d '\n' < class.txt)

          echo "ðŸŽ‰ All jobs succeeded"
          echo "File value (class.txt): $FILE_VALUE"
          echo "Repository variable (NathanK): $REPO_VAR"
          echo "Secret comparison succeeded (secret not printed)"
